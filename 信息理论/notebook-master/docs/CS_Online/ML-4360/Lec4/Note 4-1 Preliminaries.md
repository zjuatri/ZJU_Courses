# 4.1 准备工作 | Preliminaries

!!! note ""
    本讲座的这一部分涵盖了以下两个问题：

    1. 如何将图像配置到适当的位置，以便进行快速匹配？
    2. 如何从实际测量值（所谓的视差）中获取深度信息？

!!! question "如何从图像中恢复3D结构？"

    ??? question "不适定问题"
        经典的数学物理方程定解问题中，人们只研究适定问题。适定问题是指定解满足下面三个要求的问题：

        1. 解是存在的；
        2. 解是唯一的；
        3. 解连续依赖于定解条件，即解是稳定的。
        
        因此我们可以发现这三个要求中，只要有一个不满足，则称之为不适定问题。

    一般来说，从图像中恢复3D结构是一个不适定/病态问题，但有几个线索可以使用：

    遮挡(Occlusion)：一个物体被另一个物体遮挡，提供了信息，哪个物体在场景前方，哪个在后方。

    视差(Parallax)：如果两个物体在镜像反射中的相对位置不同，这些物体不能位于相同的深度。

    透视(Perspective)：平行结构的行为揭示了深度信息。

    调焦(Acccomodation)：模糊的物体与焦点清晰的物体深度不同。

    立体视觉(Stereopsis)：通过使用三角测量原理，在已知相机位置的情况下，可以从物体在不同图像上的运动中计算出物体的3D位置。

!!! question "为什么要使用双目立体视觉？"

    双目立体视觉是一种已建立的系统，大多数物种都有两只眼睛。从概念上讲，这是一个相对稳健地感知深度的最小配置。在某些情况下，这个概念已经被利用，通过人工扩大基线（即摄像机之间的距离）来获得更好的深度精度。两个例子是眼柄蝇和立体测距仪。

## 4.1.1 双视图立体匹配 | Two-View Stereo Matching

目标：从输入图像中恢复每个像素的视差。视差（disparity 或反深度，inverse depth）定义为两个图像中像素之间的相对位移。

任务：从两幅静态场景的图像构建一个密集的3D模型，例如使用同步相机捕捉的场景。

流程：

1. 对相机进行内部和外部校准（第3.1讲）。
2. 给定校准，对图像进行校正。
3. 为参考图像计算视差图。
4. 使用一致性/遮挡测试来去除离群值。
5. 利用相机校准从视差中获取深度信息。
6. 构建3D模型，例如通过体积融合和网格化。

## 4.1.2 3D重建流程 | 3D Reconstruction Pipeline

给定一组输入图像，首先计算相机的姿态，例如使用增量式束调整。

相机的姿态使我们能够通过极线几何为每一对相邻视图计算密集的对应关系。

这些对应关系可以用来恢复深度图。通过深度图融合，这些图导致了一个一致的3D模型，考虑了所有已经获得的观察。

本讲涵盖了对应关系和深度图的计算。

## 4.1.3 极线几何 | Epipolar Geometry

回顾：一个3D点 $\mathbf{x}$ 被投影到两幅图像上，如下所示：

$$\bar{\mathbf{x}}_1\propto\tilde{\mathbf{x}}_1=\mathrm{K}_1\mathrm{x}$$

和

$$\bar{\mathbf{x}}_2\propto\tilde{\mathbf{x}}_2=\mathrm{K}_2\mathrm{x}$$

图像的对应关系由以下公式联系：

$$\tilde{\mathbf{x}}_2^T\mathbf{E}\tilde{\mathbf{x}}_1=0$$

其中 $\tilde{\mathbf{x}}_i=\mathrm{K}_i^{-1}\bar{\mathbf{x}}_i$。

像素 ${\mathbf{x}}_1$ 的对应关系位于极线上

$$\tilde{\mathbf{l}}_2=\mathbf{E}\tilde{\mathbf{x}}_1$$

以及像素 ${\mathbf{x}}_2$ 的对应关系位于极线上

$$\tilde{\mathbf{l}}_1=\mathbf{E}^T\tilde{\mathbf{x}}_2$$

所有的极线都在极点相交。在本讲座中，像素的对应关系必须位于极线上的特性将被利用，以将对应关系搜索简化为一个更简单的一维问题。考虑到一个VGA图像，包含所有像素的搜索空间（约300,000像素）减小到只包含一个极线的搜索空间（约640像素）。

## 4.1.4 图像矫正 | Image Rectification

!!! question "如果两台相机正好面对完全相同的方向呢？"

    如果两台相机正好面对相同的方向，它们的图像平面将共面且平行于基线。这意味着极点位于无穷远处（在图像外部），所有的极线彼此平行且水平于图像上。在这种设置下，可以沿着水平扫描线进行对应关系搜索，从而简化了实现过程。

!!! question "如果图像不符合所需的配置怎么办？？"

    我们可以通过旋转来重新调整图像，将两个图像平面映射到与基线平行的公共平面上。这个过程称为矫正，不需要知道三维结构的信息。类似于拼接全景图的单应性变换（homogrpahy），可以通过估算旋转单应性变换来计算围绕相机中心的旋转。

!!!     