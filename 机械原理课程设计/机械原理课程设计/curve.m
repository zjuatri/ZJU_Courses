%% 进入复位区圆弧参数计算
% 定义复位区的角度范围（度）
Fai_CD = [117.517;125];  % 复位区起始角度和结束角度

% 定义初始位移参数
x1 = 14.147;        % 复位区起始位移（mm）
v1 = 1269.937;      % 复位区起始速度（mm/s）
v2 = 1175.302;      % 复位区结束速度（mm/s）

% 凸轮转速计算
omiga = 4500/3600*360;  % 凸轮角速度：4500转/分钟转换为度/秒

% 计算速度变化率和倾斜角
k = (v1-v2)/omiga;      % 速度变化率（mm/度）
theta_k = atan(k);      % 速度变化对应的角度（弧度）

% 计算圆弧半径和位移增量
R = (Fai_CD(2)-Fai_CD(1))/sin(theta_k);  % 圆弧半径（mm）
delta_x = R*(1-cos(theta_k));             % 圆弧段的位移增量（mm）

%% 复位区结束补偿量计算
% 计算复位区结束时的总位移
h = x1+delta_x;         % 复位区结束位移 = 起始位移 + 圆弧位移增量

% 定义补偿函数参数
Delta_t = 100;          % 补偿区总角度范围（度）

% 定义位移补偿函数（余弦加速度运动规律）
% 该函数描述了复位区的位移变化规律
f = @(Delta_1) (h*(1-(Delta_1/Delta_t)+1/2/pi*sin(Delta_1/Delta_t*2*pi)));

% 生成补偿区角度序列和对应的位移
Delta_1 = 0:5:100;      % 补偿区角度范围，步长为5度
s = f(Delta_1);         % 计算各角度对应的补偿位移

%% 绘制补偿量曲线
% 定义圆弧段的几何参数
startPoint = [Fai_CD(1), x1];    % 圆弧起点坐标（角度，位移）
endPoint = [Fai_CD(2), h];       % 圆弧终点坐标（角度，位移）
center = [Fai_CD(2), h-R];       % 圆弧圆心坐标

% 计算起点和终点相对于圆心的角度
theta1 = atan2(startPoint(2) - center(2), startPoint(1) - center(1));  % 起点角度
theta2 = atan2(endPoint(2) - center(2), endPoint(1) - center(1));      % 终点角度

% 生成圆弧上的采样点
t = linspace(theta1, theta2, 20);   % 在起点和终点之间生成20个等间距角度
arcX = center(1) + R * cos(t);      % 圆弧上各点的横坐标（角度）
arcY = center(2) + R * sin(t);      % 圆弧上各点的纵坐标（位移）

% 组合完整的补偿曲线数据
x = [arcX,Delta_1+arcX(20)];        % 横坐标：圆弧段 + 补偿段（相对于圆弧终点）
y = [arcY,s];                       % 纵坐标：圆弧位移 + 补偿位移

% 绘制最终的位移补偿曲线
plot(x,y)
xlabel("凸轮转角°")                 % 横轴标签
ylabel("补偿量mm")                  % 纵轴标签
title("复位区位移补偿量曲线图")      % 图标题